{% extends "base.html" %}

{% block title %}Edit Product - FreshBasket Admin{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Edit Product</h1>
        <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">‚Üê Back to Products</a>
    </div>

    <div class="form-container">
        <form method="POST" enctype="multipart/form-data" class="product-form">
            <div class="form-grid">
                <div class="form-group">
                    <label for="name">Product Name *</label>
                    <input type="text" id="name" name="name" class="form-input" required value="{{ product.name }}">
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" name="category" class="form-select" required>
                        <option value="vegetables" {% if product.category == 'vegetables' %}selected{% endif %}>Vegetables</option>
                        <option value="fruits" {% if product.category == 'fruits' %}selected{% endif %}>Fruits</option>
                        <option value="dairy" {% if product.category == 'dairy' %}selected{% endif %}>Dairy</option>
                        <option value="bakery" {% if product.category == 'bakery' %}selected{% endif %}>Bakery</option>
                        <option value="meat" {% if product.category == 'meat' %}selected{% endif %}>Meat & Seafood</option>
                        <option value="pantry" {% if product.category == 'pantry' %}selected{% endif %}>Pantry Essentials</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="price">Price ($) *</label>
                    <input type="number" id="price" name="price" class="form-input" step="0.01" min="0.01" required value="{{ product.price }}">
                </div>

                <div class="form-group">
                    <label for="stock">Stock Quantity *</label>
                    <input type="number" id="stock" name="stock" class="form-input" min="0" required value="{{ product.stock }}">
                </div>

                <div class="form-group full-width">
                    <label for="description">Description *</label>
                    <textarea id="description" name="description" class="form-textarea" rows="4" required>{{ product.description }}</textarea>
                </div>

                <div class="form-group full-width">
                    <label for="image_file">Upload New Image</label>
                    <input type="file" id="image_file" name="image_file" class="form-input" accept="image/*" onchange="previewNewImage(event)">
                    <small>Supported formats: JPG, PNG, GIF, WEBP (Max 16MB) - Leave empty to keep current image</small>
                </div>

                <div class="form-group full-width">
                    <label for="image_url">Current Image URL</label>
                    <input type="url" id="image_url" name="image_url" class="form-input" value="{{ product.image_url }}">
                    <div class="image-preview">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" id="preview-img">
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
function previewNewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview-img').src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

document.getElementById('image_url').addEventListener('input', function(e) {
    document.getElementById('preview-img').src = e.target.value;
});
</script>
{% endblock %}
